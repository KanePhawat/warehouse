<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</title>
    <script>
      function removeRow(button) {
        const row = button.parentNode;
        row.remove();
      }

      function prepareVariantData() {
        const rows = document.querySelectorAll(".variant-row");
        const data = [];
        rows.forEach((row) => {
          const pack_size = row.querySelector(".pack_size").value;
          const selling_price = row.querySelector(".selling_price").value;
          const sale_mode = row.querySelector(".sale_mode").value;
          const sku_suffix = row.querySelector(".sku_suffix")?.value || "";

          // ‚úÖ ‡∏Ç‡πâ‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô "‡πÅ‡∏¢‡∏Å‡∏ä‡∏¥‡πâ‡∏ô"
          if (!sale_mode || pack_size === "" || selling_price === "") return;

          if (pack_size && selling_price) {
            data.push({ pack_size, selling_price, sale_mode, sku_suffix });
          }
        });

        document.getElementById("variant_data").value = JSON.stringify(data);
      }
      function addVariantRow() {
        const container = document.getElementById("variant-container");
        const row = document.createElement("div");
        row.className = "variant-row";

        const isFirstRow = container.children.length === 0;

        row.innerHTML = `
          <select class="sale_mode"required>
              <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö</option>
              <option value="single">‡πÅ‡∏¢‡∏Å‡∏ä‡∏¥‡πâ‡∏ô</option>
              <option value="pack">‡∏¢‡∏Å‡πÅ‡∏û‡πá‡∏Ñ</option>
              <option value="box">‡∏¢‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á</option>
          </select>
          <input type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πà‡∏≠‡πÅ‡∏û‡πá‡∏Ñ" class="pack_size" min="1" required>
          <input type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢" step="0.01" class="selling_price" min="0" required>
          <input type="text" placeholder="SKU ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô -P, -B)" class="sku_suffix" />
          ${
            isFirstRow
              ? ""
              : '<button type="button" onclick="removeRow(this)">üóëÔ∏è</button>'
          }
        `;
        container.appendChild(row);

        // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° logic: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡πÅ‡∏¢‡∏Å‡∏ä‡∏¥‡πâ‡∏ô" ‚Üí ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô/‡πÅ‡∏û‡πá‡∏Ñ = 1 ‡πÅ‡∏•‡∏∞ disabled
        const saleModeSelect = row.querySelector(".sale_mode");
        const packSizeInput = row.querySelector(".pack_size");

        saleModeSelect.addEventListener("change", () => {
          if (saleModeSelect.value === "single") {
            packSizeInput.value = 1;
            packSizeInput.disabled = true;
          } else {
            packSizeInput.disabled = false;
            packSizeInput.value = ""; // ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á
          }
        });
      }
      window.addEventListener("DOMContentLoaded", () => {
        addVariantRow(); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î
      });

      function removeRow(button) {
        const container = document.getElementById("variant-container");
        if (container.children.length <= 1) {
          alert("‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
          return;
        }
        const row = button.parentNode;
        row.remove();
      }
    </script>
    <style>
      .variant-row {
        display: flex;
        gap: 10px;
        margin-bottom: 8px;
      }
    </style>
  </head>
  <body>
    <h1>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h1>
    <!-- ‚úÖ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡∏•‡∏∞‡∏ä‡∏¥‡πâ‡∏ô -->
    <form
      method="post"
      enctype="multipart/form-data"
      onsubmit="prepareVariantData()"
    >
      <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: <input type="text" name="name" required /></label
      ><br /><br />
      <label>SKU: <input type="text" name="sku" required /></label><br /><br />
      <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: <input type="text" name="category" /></label><br /><br />
      <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö:</label>
      <input
        type="text"
        name="unit"
        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏¥‡πâ‡∏ô, ‡∏Å‡∏•‡πà‡∏≠‡∏á, ‡πÉ‡∏ö, ‡πÅ‡∏û‡πá‡∏Ñ"
      /><br /><br />
      <label
        >‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:
        <input type="number" step="0.01" name="cost_price" required /></label
      ><br />

      <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏° Variant -->
      <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏¢‡∏Å‡∏ä‡∏¥‡πâ‡∏ô, ‡∏¢‡∏Å‡πÅ‡∏û‡πá‡∏Ñ, ‡∏¢‡∏Å‡∏•‡∏±‡∏á):</p>
      <div id="variant-container"></div>
      <p style="font-size: 0.9em; color: #666">
        ‡πÄ‡∏ä‡πà‡∏ô: 12 ‡∏ä‡∏¥‡πâ‡∏ô/‡πÅ‡∏û‡πá‡∏Ñ ‡∏£‡∏≤‡∏Ñ‡∏≤ 100 ‡∏ö‡∏≤‡∏ó ‡∏Ç‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö "‡∏¢‡∏Å‡πÅ‡∏û‡πá‡∏Ñ"
      </p>
      <button type="button" onclick="addVariantRow()">
        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
      </button>
      <input type="hidden" id="variant_data" name="variant_data" />
      <br /><br />

      <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
      <input type="file" name="image" accept="image/*" /><br /><br />
      <button type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
      <br /><br />
    </form>
    <hr />
    <!-- üì• ‡∏ü‡∏≠‡∏£‡πå‡∏° import CSV -->
    <h2>‡∏´‡∏£‡∏∑‡∏≠ Import CSV</h2>
    <form
      method="POST"
      enctype="multipart/form-data"
      action="{{ url_for('add_product') }}"
    >
      <input type="hidden" name="mode" value="csv" />
      <input type="file" name="csv_file" accept=".csv" required />
      <button type="submit">Import CSV</button>
    </form>
    <br />
    <a href="{{ url_for('index') }}">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
  </body>

  <!-- ‚ö° ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° -->
  {% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %}
  <ul>
    {% for category, message in messages %}
    <li
      style="color: {% if category == 'error' %}red{% else %}green{% endif %};"
    >
      {{ message }}
    </li>
    {% endfor %}
  </ul>
  {% endif %} {% endwith %}
</html>
